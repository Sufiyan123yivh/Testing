name: Update Zee5 Playlist

on:
  push:
  workflow_dispatch:
  schedule:
    - cron: "*/10 * * * *"

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Fetch Zee5 RAW URL
        id: fetch
        run: |
          echo "Fetching Zee Bangla URL..."
          RAW=$(curl -s -L -A "Mozilla/5.0" "http://mini.allinonereborn.fun/zee-paid/index.php?id=0-9-zeebangla")
          echo "$RAW" > raw_debug.txt

          ZEE_URL=$(echo "$RAW" | grep -o 'https://z5ak-cmaflive\.zee5\.com[^"]*' | head -n 1)
          echo "ZEE_URL: $ZEE_URL"

          if [ -z "$ZEE_URL" ]; then
            echo "token=" >> "$GITHUB_OUTPUT"
            exit 0
          fi

          ZEE_URL_CLEAN=$(echo "$ZEE_URL" | sed 's/&amp;/\&/g')

          QUERY=$(echo "$ZEE_URL_CLEAN" | cut -d'?' -f2-)
          TOKEN="?${QUERY}"

          echo "Extracted TOKEN: $TOKEN"
          echo "$TOKEN" > token.txt

          ESCAPED_TOKEN=$(echo "$TOKEN" | sed 's/%/%25/g; s/\r/%0D/g; s/\n/%0A/g')
          echo "token=$ESCAPED_TOKEN" >> "$GITHUB_OUTPUT"

      - name: Print Token (Debug)
        run: |
          echo "Token from output: ${{ steps.fetch.outputs.token }}"
