name: Zee5 Debug Fetch

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Fetch Zee5 RAW URL
        id: fetch
        run: |
          echo "Fetching Zee Bangla URL..."
          RAW=$(curl -s -L -A "Mozilla/5.0" "http://mini.allinonereborn.fun/zee-paid/index.php?id=0-9-zeebangla")

          echo "---------------- RAW RESPONSE ----------------"
          echo "$RAW"
          echo "---------------- END RAW ---------------------"

          # Save RAW to file for inspection
          echo "$RAW" > raw_debug.txt

          # Extract token only if URL contains ?hdntl=
          TOKEN=$(echo "$RAW" | grep -o '?hdntl=.*')

          echo "Extracted TOKEN: $TOKEN"

          # Save token
          echo "$TOKEN" > token.txt

          # Export output
          echo "token=$TOKEN" >> $GITHUB_OUTPUT

      - name: Commit Debug Files
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"

          git add raw_debug.txt token.txt
          git commit -m "Debug Zee5 token $(date)" || exit 0
          git push
