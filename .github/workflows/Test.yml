- name: Fetch Zee5 RAW URL
  id: fetch
  run: |
    echo "Fetching Zee Bangla URL..."
    RAW=$(curl -s -L -A "Mozilla/5.0" "http://mini.allinonereborn.fun/zee-paid/index.php?id=0-9-zeebangla")

    echo "--------------- RAW ---------------"
    echo "$RAW"
    echo "-----------------------------------"

    echo "$RAW" > raw_debug.txt

    # Extract the FIRST full Zee5 live URL
    ZEE_URL=$(echo "$RAW" | grep -o 'https://z5ak-cmaflive\.zee5\.com[^"]*' | head -n 1)

    echo "ZEE_URL: $ZEE_URL"

    if [ -z "$ZEE_URL" ]; then
      echo "No z5ak-cmaflive.zee5.com URL found"
      echo "token=" >> $GITHUB_OUTPUT
      exit 0
    fi

    # Decode HTML entities (&amp; â†’ &)
    ZEE_URL_CLEAN=$(echo "$ZEE_URL" | sed 's/&amp;/\&/g')

    echo "Clean URL: $ZEE_URL_CLEAN"

    # Extract only the query part of URL
    QUERY=${ZEE_URL_CLEAN#*\?}
    TOKEN="?${QUERY}"

    echo "Extracted TOKEN: $TOKEN"

    echo "$TOKEN" > token.txt

    #
    # IMPORTANT: Escape token before writing to GitHub output
    #
    ESCAPED_TOKEN="${TOKEN//'%'/'%25'}"
    ESCAPED_TOKEN="${ESCAPED_TOKEN//$'\n'/'%0A'}"
    ESCAPED_TOKEN="${ESCAPED_TOKEN//$'\r'/'%0D'}"

    echo "token=$ESCAPED_TOKEN" >> $GITHUB_OUTPUT
